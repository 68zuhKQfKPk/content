id: Crowdstrike SIEM ingestion
version: -1
name: Crowdstrike SIEM ingestion
description: The playbook handles when the incident ingestion was done from the SIEM. The user provides which incident fields contain the incident or detection ID, also which fields differentiates if this is an incident or detection. In addition it also allows to change the severity according to a user defined scale to override the default assigned severity as well as grab the CrowdStrike detections based on the CrowdStrike incident.
starttaskid: '0'
tasks:
  '0':
    id: '0'
    taskid: 52e83efb-9923-48db-8890-154683292a27
    type: start
    task:
      id: 52e83efb-9923-48db-8890-154683292a27
      version: -1
      name: ''
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '1'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 80
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '1':
    id: '1'
    taskid: 2e6157d8-78a2-4cd9-80b6-ca7963f95891
    type: condition
    task:
      id: 2e6157d8-78a2-4cd9-80b6-ca7963f95891
      version: -1
      name: Verify if incident or detection
      type: condition
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#default#':
      - '18'
      detection:
      - '2'
      incident:
      - '3'
    separatecontext: false
    conditions:
    - label: incident
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SIEMincidentFieldForType
            iscontext: true
          right:
            value:
              simple: incident
          ignorecase: true
    - label: detection
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SIEMincidentFieldForType
            iscontext: true
          right:
            value:
              simple: detection
          ignorecase: true
    view: |-
      {
        "position": {
          "x": 480,
          "y": 210
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '2':
    id: '2'
    taskid: 8177647f-a924-453c-87da-0bd971fc0fa7
    type: regular
    task:
      id: 8177647f-a924-453c-87da-0bd971fc0fa7
      version: -1
      name: Get full detection details
      description: Search for details of specific detections, either using a filter query, or by providing the IDs of the detections.
      script: '|||cs-falcon-search-detection'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '15'
    scriptarguments:
      extended_data:
        simple: Yes
      ids:
        simple: ${inputs.SIEMincidentFieldForID}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 280,
          "y": 380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    fieldMapping:
    - incidentfield: File Names
      output:
        simple: ${CrowdStrike.Detection.Behavior.FileName}
    - incidentfield: Scenario
      output:
        simple: ${CrowdStrike.Detection.Behavior.Scenario}
    - incidentfield: Process MD5
      output:
        simple: ${CrowdStrike.Detection.Behavior.MD5}
    - incidentfield: Process SHA256
      output:
        simple: ${CrowdStrike.Detection.Behavior.SHA256}
    - incidentfield: Process CMD
      output:
        simple: ${CrowdStrike.Detection.Behavior.CommandLine}
    - incidentfield: Agents ID
      output:
        simple: ${CrowdStrike.Detection.System}
    - incidentfield: Device External IPs
      output:
        simple: ${CrowdStrike.Detection.System}
    - incidentfield: External Severity
      output:
        simple: ${CrowdStrike.Detection.MaxSeverity}
    - incidentfield: External Confidence
      output:
        simple: ${CrowdStrike.Detection.MaxConfidence}
    - incidentfield: External End Time
      output:
        simple: ${CrowdStrike.Detection.LastBehavior}
    - incidentfield: ' External Start Time'
      output:
        simple: ${CrowdStrike.Detection.FirstBehavior}
    - incidentfield: External Status
      output:
        simple: ${CrowdStrike.Detection.Status}
    - incidentfield: Hostnames
      output:
        simple: ${CrowdStrike.Detection.Device.hostname}
    - incidentfield: Device OS Name
      output:
        simple: ${CrowdStrike.Detection.Device.platform_name}
    - incidentfield: Device OS Version
      output:
        simple: ${CrowdStrike.Detection.Device.os_version}
    - incidentfield: MITRE Tactic ID
      output:
        simple: ${CrowdStrike.Detection.Behavior.TacticID}
    - incidentfield: MITRE Tactic Name
      output:
        simple: ${CrowdStrike.Detection.Behavior.Tactic}
    - incidentfield: MITRE Technique ID
      output:
        simple: ${CrowdStrike.Detection.Behavior.TechniqueId}
    - incidentfield: MITRE Technique Name
      output:
        simple: ${CrowdStrike.Detection.Behavior.Technique}
    - incidentfield: Users
      output:
        simple: ${CrowdStrike.Detection.Behavior.UserName}
    - incidentfield: External Category Name
      output:
        simple: detection
    - incidentfield: Device MAC Address
      output:
        simple: ${CrowdStrike.Detection.Device.mac_address}
    - incidentfield: Description
      output:
        simple: ${CrowdStrike.Detection.Behavior.Description}
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '3':
    id: '3'
    taskid: 5937f18b-8a25-4acb-835a-dda3ba512483
    type: regular
    task:
      id: 5937f18b-8a25-4acb-835a-dda3ba512483
      version: -1
      name: Get full incident details
      description: Lists incident summaries.
      script: '|||cs-falcon-list-incident-summaries'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '6'
    scriptarguments:
      ids:
        simple: ${inputs.SIEMincidentFieldForID}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 690,
          "y": 380
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    fieldMapping:
    - incidentfield: External Category Name
      output:
        simple: incident
    - incidentfield: External Status
      output:
        simple: ${CrowdStrike.Incidents.status}
    - incidentfield: Tags
      output:
        simple: ${CrowdStrike.Incidents.tags}
    - incidentfield: External Severity
      output:
        simple: ${CrowdStrike.Incidents.fine_score}
    - incidentfield: ' External Start Time'
      output:
        simple: ${CrowdStrike.Incidents.start}
    - incidentfield: External End Time
      output:
        simple: ${CrowdStrike.Incidents.end}
    - incidentfield: Description
      output:
        simple: ${CrowdStrike.Incidents.description}
    - incidentfield: Agents ID
      output:
        simple: ${CrowdStrike.Incidents.hosts.device_id}
    - incidentfield: Device External IP
      output:
        simple: ${CrowdStrike.Incidents.hosts.external_ip}
    - incidentfield: Hostnames
      output:
        simple: ${CrowdStrike.Incidents.hosts.hostname}
    - incidentfield: Device MAC Address
      output:
        simple: ${CrowdStrike.Incidents.hosts.mac_address}
    - incidentfield: Device OS Version
      output:
        simple: ${CrowdStrike.Incidents.hosts.os_version}
    - incidentfield: Device OS Name
      output:
        simple: ${CrowdStrike.Incidents.hosts.platform_name}
    - incidentfield: MITRE Tactic Name
      output:
        simple: ${CrowdStrike.Incidents.tactics}
    - incidentfield: MITRE Technique Name
      output:
        simple: ${CrowdStrike.Incidents.techniques}
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '4':
    id: '4'
    taskid: 555c6448-233b-491c-84e0-a8e63259243d
    type: title
    task:
      id: 555c6448-233b-491c-84e0-a8e63259243d
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ''
      description: ''
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1820
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '5':
    id: '5'
    taskid: 318cf5c4-dc2c-4b4b-8a0a-28d01543878b
    type: regular
    task:
      id: 318cf5c4-dc2c-4b4b-8a0a-28d01543878b
      version: -1
      name: Set Severity
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - '12'
    scriptarguments:
      severity:
        complex:
          root: CrowdStrike.Detection
          accessor: MaxSeverity
          transformers:
          - operator: MapValuesTransformer
            args:
              input_values:
                value:
                  simple: inputs.ScaleToSetSeverity
                iscontext: true
              mapped_values:
                value:
                  simple: inputs.SeverityValuesMapping
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 270,
          "y": 1190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '6':
    id: '6'
    taskid: 2bb37186-a026-4de6-803b-ff80e9ee9ce5
    type: regular
    task:
      id: 2bb37186-a026-4de6-803b-ff80e9ee9ce5
      version: -1
      name: Get detections for incident
      description: Gets the detections for a specific incident.
      script: '|||cs-falcon-get-detections-for-incident'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '8'
    scriptarguments:
      incident_id:
        simple: ${CrowdStrike.Incidents.incident_id}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 690,
          "y": 530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '8':
    id: '8'
    taskid: 68f57416-0049-4014-8b8a-27b5b7ca5e86
    type: regular
    task:
      id: 68f57416-0049-4014-8b8a-27b5b7ca5e86
      version: -1
      name: Get full detection details
      description: Search for details of specific detections, either using a filter query, or by providing the IDs of the detections.
      script: '|||cs-falcon-search-detection'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '13'
    scriptarguments:
      extended_data:
        simple: Yes
      ids:
        simple: ${CrowdStrike.IncidentDetection.detection_ids}
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 690,
          "y": 700
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    fieldMapping:
    - incidentfield: File Names
      output:
        simple: ${CrowdStrike.Detection.Behavior.FileName}
    - incidentfield: Scenario
      output:
        simple: ${CrowdStrike.Detection.Behavior.Scenario}
    - incidentfield: Process MD5
      output:
        simple: ${CrowdStrike.Detection.Behavior.MD5}
    - incidentfield: Process SHA256
      output:
        simple: ${CrowdStrike.Detection.Behavior.SHA256}
    - incidentfield: Process CMD
      output:
        simple: ${CrowdStrike.Detection.Behavior.CommandLine}
    - incidentfield: External Confidence
      output:
        simple: ${CrowdStrike.Detection.MaxConfidence}
    - incidentfield: Users
      output:
        simple: ${CrowdStrike.Detection.Behavior.UserName}
    - incidentfield: MITRE Technique ID
      output:
        simple: ${CrowdStrike.Detection.Behavior.TechniqueId}
    - incidentfield: MITRE Tactic ID
      output:
        simple: ${CrowdStrike.Detection.Behavior.TacticID}
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '9':
    id: '9'
    taskid: 9631958a-8c1f-46cb-8054-946a3d653fde
    type: regular
    task:
      id: 9631958a-8c1f-46cb-8054-946a3d653fde
      version: -1
      name: Set Severity
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - '12'
    scriptarguments:
      severity:
        complex:
          root: CrowdStrike.Incidents
          accessor: fine_score
          transformers:
          - operator: MapValuesTransformer
            args:
              input_values:
                value:
                  simple: inputs.ScaleToSetSeverity
                iscontext: true
              mapped_values:
                value:
                  simple: inputs.SeverityValuesMapping
                iscontext: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 690,
          "y": 1190
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '10':
    id: '10'
    taskid: 15148b3b-e08d-442b-82a8-0b986467f72f
    type: regular
    task:
      id: 15148b3b-e08d-442b-82a8-0b986467f72f
      version: -1
      name: Enrich endpoint details
      description: Returns information about an endpoint.
      script: '|||endpoint'
      type: regular
      iscommand: true
      brand: ''
    nexttasks:
      '#none#':
      - '11'
    scriptarguments:
      id:
        simple: ${incident.agentsid}
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1480
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    fieldMapping:
    - incidentfield: Device Status
      output:
        simple: ${Endpoint.IsIsolated}
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '11':
    id: '11'
    taskid: a3ab8a8f-116c-4471-8912-27cc94fa5234
    type: regular
    task:
      id: a3ab8a8f-116c-4471-8912-27cc94fa5234
      version: -1
      name: Set Endpoint information to layout
      description: commands.local.cmd.set.incident
      script: Builtin|||setIncident
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - '4'
    scriptarguments:
      deviceid:
        simple: ${Endpoint.[0].ID}
      devicelocalip:
        simple: ${Endpoint.[0].IPAddress}
      devicemacaddress:
        simple: ${Endpoint.[0].MACAddress}
      devicename:
        simple: ${Endpoint.[0].Hostname}
      deviceosname:
        simple: ${Endpoint.[0].OS}
      deviceosversion:
        simple: ${Endpoint.[0].OSVersion}
      devicestatus:
        simple: ${Endpoint.[0].Status}
      isolated:
        simple: ${Endpoint.[0].IsIsolated}
    continueonerror: true
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1650
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '12':
    id: '12'
    taskid: ff5eda85-e05b-4c68-833f-dc1eb9d06b7d
    type: title
    task:
      id: ff5eda85-e05b-4c68-833f-dc1eb9d06b7d
      version: -1
      name: Setting and Enrichment
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '10'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1360
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '13':
    id: '13'
    taskid: 71e9866a-5547-409c-842b-2e56ac5bf8c0
    type: title
    task:
      id: 71e9866a-5547-409c-842b-2e56ac5bf8c0
      version: -1
      name: Incident Severity
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '18'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 690,
          "y": 860
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '15':
    id: '15'
    taskid: 4492191a-b69d-4101-8ff6-6e930791c77a
    type: title
    task:
      id: 4492191a-b69d-4101-8ff6-6e930791c77a
      version: -1
      name: Detection Severity
      type: title
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#none#':
      - '18'
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 280,
          "y": 860
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  '18':
    id: '18'
    taskid: 06fcb5ec-5152-4fe8-80d1-b3d6ce086689
    type: condition
    task:
      id: 06fcb5ec-5152-4fe8-80d1-b3d6ce086689
      version: -1
      name: Verify if incident or detection
      type: condition
      iscommand: false
      brand: ''
      description: ''
    nexttasks:
      '#default#':
      - '12'
      detection:
      - '5'
      incident:
      - '9'
    separatecontext: false
    conditions:
    - label: detection
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SIEMincidentFieldForType
            iscontext: true
          right:
            value:
              simple: detection
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SetSeverity
            iscontext: true
          right:
            value:
              simple: 'true'
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.ScaleToSetSeverity
            iscontext: true
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.SeverityValuesMapping
            iscontext: true
    - label: incident
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SIEMincidentFieldForType
            iscontext: true
          right:
            value:
              simple: incident
          ignorecase: true
      - - operator: isEqualString
          left:
            value:
              simple: inputs.SetSeverity
            iscontext: true
          right:
            value:
              simple: 'true'
          ignorecase: true
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.ScaleToSetSeverity
            iscontext: true
      - - operator: isNotEmpty
          left:
            value:
              simple: inputs.SeverityValuesMapping
            iscontext: true
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1000
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1805,
        "width": 800,
        "x": 270,
        "y": 80
      }
    }
  }
inputs:
- key: SIEMincidentFieldForType
  value:
    simple: ${incident.externalcategoryname}
  required: false
  description: The incident field that contains if this is a detection or incident. Default value is incident.externalcategoryname
  playbookInputQuery:
- key: SIEMincidentFieldForID
  value:
    simple: ${incident.externalsystemid}
  required: false
  description: The name of the incident field that contains the detection or incident ID. Default value is incident.externalid
  playbookInputQuery:
- key: ScaleToSetSeverity
  value:
    simple: 0-20,21-40,41-60,61-80,81-100
  required: false
  description: |-
    The severity scale as represented in the EDR
    For example in CrowdStrike uses values from 0 to 100
    So the scale can be divided in ranges such as
    0-20,21-40,41-60,61-80,81-100
  playbookInputQuery:
- key: SeverityValuesMapping
  value:
    simple: 0.5, 1, 2, 3,4
  required: false
  description: |-
    This will provide the mapping to XSOAR severity for the ScaleToSetSeverity inputs
    For example
    0.5, 1, 2, 3,4
    Possible values to use are 0,0.5, 1, 2, 3,4
    Which represent Unknown, Informational, Low, Medium, High, Critical
  playbookInputQuery:
- key: SetSeverity
  value:
    simple: 'False'
  required: false
  description: "Indicates if to set the severity according to the  ScaleToSetSeverity and SeverityValuesMapping settings (True) or keep the original severity as mapped by the SIEM (False) \nTrue/False"
  playbookInputQuery:
outputs:
- contextPath: CrowdStrike.Detection.Behavior.FileName
  description: The file name of the behavior.
  type: string
- contextPath: CrowdStrike.Detection.Behavior.Scenario
  description: The scenario name of the behavior.
  type: string
- contextPath: CrowdStrike.Detection.Behavior.MD5
  description: The MD5 hash of the IOC of the behavior.
  type: string
- contextPath: CrowdStrike.Detection.Behavior.SHA256
  description: The SHA256 hash of the IOC of the behavior.
  type: string
- contextPath: CrowdStrike.Detection.Behavior.IOCType
  description: The type of the IOC.
  type: string
- contextPath: CrowdStrike.Detection.Behavior.IOCValue
  description: The value of the IOC.
  type: string
- contextPath: CrowdStrike.Detection.Behavior.CommandLine
  description: The command line executed in the behavior.
  type: string
- contextPath: CrowdStrike.Detection.Behavior.UserName
  description: The user name related to the behavior.
  type: string
- contextPath: CrowdStrike.Detection.Behavior.SensorID
  description: The sensor ID related to the behavior.
  type: string
- contextPath: CrowdStrike.Detection.Behavior.ParentProcessID
  description: The ID of the parent process.
  type: string
- contextPath: CrowdStrike.Detection.Behavior.ProcessID
  description: The process ID of the behavior.
  type: string
- contextPath: CrowdStrike.Detection.Behavior.ID
  description: The ID of the behavior.
  type: string
- contextPath: CrowdStrike.Detection.System
  description: The system name of the detection.
  type: string
- contextPath: CrowdStrike.Detection.CustomerID
  description: The ID of the customer (CID).
  type: string
- contextPath: CrowdStrike.Detection.MachineDomain
  description: The name of the domain of the detection machine.
  type: string
- contextPath: CrowdStrike.Detection.ID
  description: The detection ID.
  type: string
- contextPath: CrowdStrike.Detection.ProcessStartTime
  description: The start time of the process that generated the detection.
  type: string
- contextPath: Endpoint
  description: The details of the endpoint.
  type: string
tests:
- Test - CrowdStrike Falcon
fromversion: 6.5.0
